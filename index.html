# simulateur-rentabilite-immobiliere
Description: Simulateur de rentabilit√© pour investissement immobilier
<!DOCTYPE html>
<html lang="fr" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulateur Immobilier Pro</title>
    
    <!-- CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/all.min.css">
    
    <style>
        /* Variables CSS pour th√®mes */
        :root[data-theme="light"] {
            --bg-primary: #f0f2f5;
            --bg-secondary: #ffffff;
            --text-primary: #333333;
            --text-secondary: #666666;
            --card-bg: #ffffff;
            --border-color: #e1e5e9;
            --shadow: 0 8px 25px rgba(0,0,0,0.1);
            --accent: #2196F3;
            --success: #4CAF50;
            --warning: #FF9800;
            --danger: #F44336;
            --info: #2196F3;
        }

        :root[data-theme="dark"] {
            --bg-primary: #121212;
            --bg-secondary: #1e1e1e;
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --card-bg: #2d2d2d;
            --border-color: #404040;
            --shadow: 0 8px 25px rgba(0,0,0,0.3);
            --accent: #64B5F6;
            --success: #81C784;
            --warning: #FFB74D;
            --danger: #E57373;
            --info: #64B5F6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            transition: all 0.3s ease;
            /* Nouveau fond d'√©cran moderne */
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.3) 0%, transparent 50%);
            background-attachment: fixed;
        }

        /* Header */
        .header {
            background: var(--card-bg);
            padding: 20px 0;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border-bottom: 3px solid var(--accent);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: var(--accent);
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .theme-toggle {
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .theme-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn.success {
            background: var(--success);
        }

        .btn.warning {
            background: var(--warning);
        }

        /* Container principal */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px 40px 20px; /* Ajout padding bottom pour √©viter le bandeau blanc */
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            min-height: calc(100vh - 120px); /* Garantit la hauteur */
        }

        .left-panel, .right-panel {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .right-panel {
            position: sticky;
            top: 20px;
            height: fit-content;
        }

        /* Sections */
        .section {
            background: var(--bg-secondary);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .section:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .section h3 {
            color: var(--accent);
            margin-bottom: 20px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-primary);
        }

        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 16px;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        /* G√©olocalisation simplifi√©e */
        .location-input {
            position: relative;
        }

        .suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 0 0 10px 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .suggestion-item {
            padding: 12px 15px;
            cursor: pointer;
            transition: background 0.2s;
            border-bottom: 1px solid var(--border-color);
        }

        .suggestion-item:hover {
            background: var(--bg-primary);
        }

        /* Score IA */
        .score-container {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, var(--accent), var(--success));
            border-radius: 20px;
            color: white;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(
                from 0deg,
                #4CAF50 0deg,
                #4CAF50 var(--score-angle, 0deg),
                rgba(255,255,255,0.2) var(--score-angle, 0deg),
                rgba(255,255,255,0.2) 360deg
            );
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            position: relative;
        }

        .score-circle::before {
            content: '';
            position: absolute;
            width: 90px;
            height: 90px;
            background: white;
            border-radius: 50%;
        }

        .score-value {
            position: relative;
            z-index: 2;
            font-size: 24px;
            font-weight: bold;
            color: var(--text-primary);
        }

        .score-label {
            font-weight: bold;
            margin-bottom: 5px;
        }

        /* R√©sultats */
        .result-card {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .result-card:hover {
            transform: translateX(5px);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .result-label {
            font-weight: 500;
            color: var(--text-secondary);
        }

        .result-value {
            font-size: 18px;
            font-weight: bold;
        }

        .positive { color: var(--success); }
        .negative { color: var(--danger); }
        .neutral { color: var(--info); }

        /* Recommandations */
        .recommendations {
            background: linear-gradient(135deg, var(--info), var(--success));
            padding: 20px;
            border-radius: 15px;
            color: white;
            margin-top: 20px;
        }

        .recommendations h3 {
            margin-bottom: 15px;
            color: white;
        }

        .recommendation-item {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            backdrop-filter: blur(10px);
        }

        /* Donn√©es de march√© */
        .market-data {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .market-item {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .market-value {
            font-size: 18px;
            font-weight: bold;
            color: var(--accent);
        }

        .market-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .right-panel {
                position: static;
            }
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .container {
                padding: 0 15px 40px 15px;
            }
        }

        /* Sauvegarde indicateur */
        .save-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            opacity: 0;
            transform: translateX(100px);
            transition: all 0.3s ease;
            z-index: 1001;
        }

        .save-indicator.show {
            opacity: 1;
            transform: translateX(0);
        }

        /* Footer pour √©viter le bandeau blanc */
        .footer {
            background: var(--card-bg);
            padding: 30px 0;
            margin-top: 40px;
            border-top: 1px solid var(--border-color);
            text-align: center;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-home"></i> Simulateur Immobilier Pro
            </div>
            <div class="header-actions">
                <button class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon"></i>
                    <span id="themeText">Mode sombre</span>
                </button>
                <button class="btn success" onclick="sauvegarderDonnees()">
                    <i class="fas fa-save"></i> Sauvegarder
                </button>
                <button class="btn warning" onclick="exporterPDF()">
                    <i class="fas fa-file-pdf"></i> PDF
                </button>
                <button class="btn" onclick="exporterExcel()">
                    <i class="fas fa-file-excel"></i> Excel
                </button>
            </div>
        </div>
    </div>

    <!-- Indicateur de sauvegarde -->
    <div class="save-indicator" id="saveIndicator">
        <i class="fas fa-check"></i> Sauvegard√© automatiquement
    </div>

    <!-- Container principal -->
    <div class="container">
        <!-- PANEL GAUCHE - FORMULAIRE -->
        <div class="left-panel">
            <!-- Section Localisation -->
            <div class="section">
                <h3><i class="fas fa-map-marker-alt"></i> Localisation</h3>
                <div class="form-group">
                    <label for="ville">Ville</label>
                    <div class="location-input">
                        <select id="ville" onchange="chargerDonneesVille()">
                            <option value="">S√©lectionnez une ville</option>
                            <option value="paris">Paris</option>
                            <option value="lyon">Lyon</option>
                            <option value="marseille">Marseille</option>
                            <option value="toulouse">Toulouse</option>
                            <option value="nice">Nice</option>
                            <option value="nantes">Nantes</option>
                            <option value="strasbourg">Strasbourg</option>
                            <option value="montpellier">Montpellier</option>
                            <option value="bordeaux">Bordeaux</option>
                            <option value="lille">Lille</option>
                        </select>
                    </div>
                </div>
                
                <!-- Donn√©es de march√© -->
                <div id="marketData" class="market-data" style="display: none;">
                    <div class="market-item">
                        <div class="market-value" id="prixM2">-</div>
                        <div class="market-label">Prix moyen/m¬≤</div>
                    </div>
                    <div class="market-item">
                        <div class="market-value" id="loyerM2">-</div>
                        <div class="market-label">Loyer moyen/m¬≤</div>
                    </div>
                    <div class="market-item">
                        <div class="market-value" id="rentabiliteVille">-</div>
                        <div class="market-label">Rentabilit√© moyenne</div>
                    </div>
                    <div class="market-item">
                        <div class="market-value" id="tendanceMarche">-</div>
                        <div class="market-label">Tendance</div>
                    </div>
                </div>
            </div>

            <!-- Section Achat -->
            <div class="section">
                <h3><i class="fas fa-shopping-cart"></i> D√©tails de l'achat</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="prix">Prix d'achat (‚Ç¨)</label>
                        <input type="number" id="prix" value="280000" oninput="calculerEtSauver()">
                    </div>
                    <div class="form-group">
                        <label for="surface">Surface (m¬≤)</label>
                        <input type="number" id="surface" value="65" oninput="calculerEtSauver()">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="fraisNotaire">Frais de notaire (%)</label>
                        <input type="number" id="fraisNotaire" value="7.5" step="0.1" oninput="calculerEtSauver()">
                    </div>
                    <div class="form-group">
                        <label for="travaux">Travaux (‚Ç¨)</label>
                        <input type="number" id="travaux" value="15000" oninput="calculerEtSauver()">
                    </div>
                </div>
            </div>

            <!-- Section Financement -->
            <div class="section">
                <h3><i class="fas fa-university"></i> Financement</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="apport">Apport personnel (‚Ç¨)</label>
                        <input type="number" id="apport" value="70000" oninput="calculerEtSauver()">
                    </div>
                    <div class="form-group">
                        <label for="tauxCredit">Taux de cr√©dit (%)</label>
                        <input type="number" id="tauxCredit" value="3.5" step="0.1" oninput="calculerEtSauver()">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="dureeCredit">Dur√©e (ann√©es)</label>
                        <input type="number" id="dureeCredit" value="20" oninput="calculerEtSauver()">
                    </div>
                    <div class="form-group">
                        <label for="assuranceCredit">Assurance cr√©dit (%)</label>
                        <input type="number" id="assuranceCredit" value="0.36" step="0.01" oninput="calculerEtSauver()">
                    </div>
                </div>
            </div>

            <!-- Section Revenus -->
            <div class="section">
                <h3><i class="fas fa-money-bill-wave"></i> Revenus</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="loyerMensuel">Loyer mensuel (‚Ç¨)</label>
                        <input type="number" id="loyerMensuel" value="1350" oninput="calculerEtSauver()">
                    </div>
                    <div class="form-group">
                        <label for="chargesRecuperables">Charges r√©cup√©rables (‚Ç¨/mois)</label>
                        <input type="number" id="chargesRecuperables" value="50" oninput="calculerEtSauver()">
                    </div>
                </div>
            </div>

            <!-- Section Charges -->
            <div class="section">
                <h3><i class="fas fa-receipt"></i> Charges et frais</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="chargesCopro">Charges copropri√©t√© (‚Ç¨/mois)</label>
                        <input type="number" id="chargesCopro" value="120" oninput="calculerEtSauver()">
                    </div>
                    <div class="form-group">
                        <label for="taxeFonciere">Taxe fonci√®re (‚Ç¨/an)</label>
                        <input type="number" id="taxeFonciere" value="1200" oninput="calculerEtSauver()">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="assurancePno">Assurance PNO (‚Ç¨/an)</label>
                        <input type="number" id="assurancePno" value="300" oninput="calculerEtSauver()">
                    </div>
                    <div class="form-group">
                        <label for="gestionLocative">Gestion locative (%)</label>
                        <input type="number" id="gestionLocative" value="3" step="0.1" oninput="calculerEtSauver()">
                    </div>
                </div>
            </div>
        </div>

        <!-- PANEL DROIT - RESULTATS & IA -->
        <div class="right-panel">
            <!-- SCORE IA -->
            <div class="score-container">
                <div class="score-circle" id="scoreCircle" style="--score-angle: 306deg;">
                    <div class="score-value" id="scoreValue">85</div>
                </div>
                <div class="score-label" id="scoreLabel">Score d'investissement</div>
                <div id="scoreDescription">Excellent investissement</div>
            </div>

            <!-- RESULTATS FINANCIERS -->
            <div class="result-card">
                <div class="result-header">
                    <span class="result-label">üí∞ Rentabilit√© brute</span>
                    <span class="result-value positive" id="rentabiliteBrute">5.76%</span>
                </div>
            </div>

            <div class="result-card">
                <div class="result-header">
                    <span class="result-label">üìä Rentabilit√© nette</span>
                    <span class="result-value positive" id="rentabiliteNette">3.84%</span>
                </div>
            </div>

            <div class="result-card">
                <div class="result-header">
                    <span class="result-label">üí∏ Cash-flow mensuel</span>
                    <span class="result-value neutral" id="cashFlowMensuel">+156‚Ç¨</span>
                </div>
            </div>

            <div class="result-card">
                <div class="result-header">
                    <span class="result-label">üéØ Rentabilit√© sur apport</span>
                    <span class="result-value positive" id="rentabiliteApport">12.84%</span>
                </div>
            </div>

            <div class="result-card">
                <div class="result-header">
                    <span class="result-label">‚è∞ Temps de retour</span>
                    <span class="result-value neutral" id="tempsRetour">7.8 ans</span>
                </div>
            </div>

            <div class="result-card">
                <div class="result-header">
                    <span class="result-label">üè¶ Mensualit√© cr√©dit</span>
                    <span class="result-value neutral" id="mensualiteCredit">1,247‚Ç¨</span>
                </div>
            </div>

            <!-- RECOMMANDATIONS IA -->
            <div class="recommendations">
                <h3><i class="fas fa-robot"></i> Recommandations IA</h3>
                <div id="recommendationsList">
                    <div class="recommendation-item">
                        <strong>‚úÖ Rentabilit√© excellente</strong><br>
                        Votre investissement d√©passe les standards du march√©
                    </div>
                    <div class="recommendation-item">
                        <strong>üí° Optimisation sugg√©r√©e</strong><br>
                        N√©gocier le prix d'achat pour am√©liorer la rentabilit√©
                    </div>
                    <div class="recommendation-item">
                        <strong>üéØ Point d'attention</strong><br>
                        Pr√©voir une provision pour vacance locative
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer pour √©viter le bandeau blanc -->
    <div class="footer">
        <p>¬© 2024 Simulateur Immobilier Pro - Tous droits r√©serv√©s</p>
        <p>Outil d'aide √† la d√©cision - Les r√©sultats sont indicatifs</p>
    </div>

    <script>
        // Variables globales
        let currentTheme = localStorage.getItem('theme') || 'light';
        
        // Donn√©es de march√© par ville
        const donneesMarche = {
            paris: { prixM2: 10500, loyerM2: 35, rentabilite: 3.3, tendance: 'üìà Hausse' },
            lyon: { prixM2: 4800, loyerM2: 18, rentabilite: 4.5, tendance: 'üìà Hausse' },
            marseille: { prixM2: 3200, loyerM2: 14, rentabilite: 5.2, tendance: 'üìä Stable' },
            toulouse: { prixM2: 3800, loyerM2: 16, rentabilite: 4.8, tendance: 'üìà Hausse' },
            nice: { prixM2: 5200, loyerM2: 22, rentabilite: 4.2, tendance: 'üìä Stable' },
            nantes: { prixM2: 4100, loyerM2: 17, rentabilite: 4.9, tendance: 'üìà Hausse' },
            strasbourg: { prixM2: 3500, loyerM2: 15, rentabilite: 5.1, tendance: 'üìä Stable' },
            montpellier: { prixM2: 3900, loyerM2: 16, rentabilite: 4.9, tendance: 'üìà Hausse' },
            bordeaux: { prixM2: 4200, loyerM2: 17, rentabilite: 4.8, tendance: 'üìä Stable' },
            lille: { prixM2: 2800, loyerM2: 13, rentabilite: 5.5, tendance: 'üìà Hausse' }
        };

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            appliquerTheme(currentTheme);
            chargerDonneesSauvegardees();
            calculer();
        });

        // Fonction de calcul principal
        function calculer() {
            const prix = parseFloat(document.getElementById('prix').value) || 0;
            const surface = parseFloat(document.getElementById('surface').value) || 0;
            const fraisNotaire = parseFloat(document.getElementById('fraisNotaire').value) || 0;
            const travaux = parseFloat(document.getElementById('travaux').value) || 0;
            const apport = parseFloat(document.getElementById('apport').value) || 0;
            const tauxCredit = parseFloat(document.getElementById('tauxCredit').value) || 0;
            const dureeCredit = parseFloat(document.getElementById('dureeCredit').value) || 0;
            const assuranceCredit = parseFloat(document.getElementById('assuranceCredit').value) || 0;
            const loyerMensuel = parseFloat(document.getElementById('loyerMensuel').value) || 0;
            const chargesRecuperables = parseFloat(document.getElementById('chargesRecuperables').value) || 0;
            const chargesCopro = parseFloat(document.getElementById('chargesCopro').value) || 0;
            const taxeFonciere = parseFloat(document.getElementById('taxeFonciere').value) || 0;
            const assurancePno = parseFloat(document.getElementById('assurancePno').value) || 0;
            const gestionLocative = parseFloat(document.getElementById('gestionLocative').value) || 0;

            // Calculs
            const fraisNotaireEuros = prix * (fraisNotaire / 100);
            const investissementTotal = prix + fraisNotaireEuros + travaux;
            const montantEmprunte = investissementTotal - apport;
            
            const tauxMensuel = tauxCredit / 100 / 12;
            const nbMensualites = dureeCredit * 12;
            let mensualiteCredit = 0;
            if (tauxMensuel > 0) {
                mensualiteCredit = montantEmprunte * (tauxMensuel * Math.pow(1 + tauxMensuel, nbMensualites)) / (Math.pow(1 + tauxMensuel, nbMensualites) - 1);
            } else {
                mensualiteCredit = montantEmprunte / nbMensualites;
            }
            
            const assuranceMensuelle = montantEmprunte * (assuranceCredit / 100) / 12;
            
            const revenus = loyerMensuel + chargesRecuperables;
            const chargesMensuelles = chargesCopro + (taxeFonciere / 12) + (assurancePno / 12) + (revenus * gestionLocative / 100);
            
            const cashFlowMensuel = revenus - mensualiteCredit - assuranceMensuelle - chargesMensuelles;
            const revenuAnnuelNet = (revenus - chargesMensuelles) * 12;
            
            const rentabiliteBrute = ((loyerMensuel * 12) / prix
            const rentabiliteBrute = ((loyerMensuel * 12) / prix) * 100;
            const rentabiliteNette = (revenuAnnuelNet / investissementTotal) * 100;
            const rentabiliteApport = ((cashFlowMensuel * 12) / apport) * 100;
            const tempsRetour = apport / (Math.abs(cashFlowMensuel * 12));

            // Mise √† jour de l'affichage
            document.getElementById('rentabiliteBrute').textContent = rentabiliteBrute.toFixed(2) + '%';
            document.getElementById('rentabiliteNette').textContent = rentabiliteNette.toFixed(2) + '%';
            document.getElementById('cashFlowMensuel').textContent = (cashFlowMensuel >= 0 ? '+' : '') + Math.round(cashFlowMensuel).toLocaleString() + '‚Ç¨';
            document.getElementById('rentabiliteApport').textContent = rentabiliteApport.toFixed(2) + '%';
            document.getElementById('tempsRetour').textContent = tempsRetour.toFixed(1) + ' ans';
            document.getElementById('mensualiteCredit').textContent = Math.round(mensualiteCredit + assuranceMensuelle).toLocaleString() + '‚Ç¨';

            // Mise √† jour des classes pour les couleurs
            mettreAJourCouleurs('rentabiliteBrute', rentabiliteBrute, 4, 6);
            mettreAJourCouleurs('rentabiliteNette', rentabiliteNette, 3, 5);
            mettreAJourCouleurs('cashFlowMensuel', cashFlowMensuel, 0, 200);
            mettreAJourCouleurs('rentabiliteApport', rentabiliteApport, 8, 15);

            // Calcul du score IA
            calculerScoreIA(rentabiliteBrute, rentabiliteNette, cashFlowMensuel, rentabiliteApport);
            
            // G√©n√©rer recommandations
            genererRecommandations(rentabiliteBrute, rentabiliteNette, cashFlowMensuel, prix, loyerMensuel);
        }

        function mettreAJourCouleurs(elementId, valeur, seuilNegatif, seuilPositif) {
            const element = document.getElementById(elementId);
            element.classList.remove('positive', 'negative', 'neutral');
            
            if (valeur >= seuilPositif) {
                element.classList.add('positive');
            } else if (valeur <= seuilNegatif) {
                element.classList.add('negative');
            } else {
                element.classList.add('neutral');
            }
        }

        function calculerScoreIA(rentabiliteBrute, rentabiliteNette, cashFlow, rentabiliteApport) {
            let score = 0;
            
            // Crit√®res de notation
            if (rentabiliteBrute >= 7) score += 25;
            else if (rentabiliteBrute >= 5) score += 20;
            else if (rentabiliteBrute >= 4) score += 15;
            else if (rentabiliteBrute >= 3) score += 10;
            
            if (rentabiliteNette >= 5) score += 20;
            else if (rentabiliteNette >= 4) score += 15;
            else if (rentabiliteNette >= 3) score += 10;
            else if (rentabiliteNette >= 2) score += 5;
            
            if (cashFlow >= 300) score += 20;
            else if (cashFlow >= 100) score += 15;
            else if (cashFlow >= 0) score += 10;
            else if (cashFlow >= -100) score += 5;
            
            if (rentabiliteApport >= 15) score += 20;
            else if (rentabiliteApport >= 12) score += 15;
            else if (rentabiliteApport >= 10) score += 10;
            else if (rentabiliteApport >= 8) score += 5;
            
            // Bonus localisation
            const ville = document.getElementById('ville').value;
            if (ville && donneesMarche[ville]) {
                if (donneesMarche[ville].tendance.includes('Hausse')) score += 10;
                else if (donneesMarche[ville].tendance.includes('Stable')) score += 5;
            }
            
            score = Math.min(100, Math.max(0, score));
            
            // Mise √† jour de l'affichage
            document.getElementById('scoreValue').textContent = score;
            document.getElementById('scoreCircle').style.setProperty('--score-angle', (score * 3.6) + 'deg');
            
            let description, couleur;
            if (score >= 80) {
                description = 'Excellent investissement';
                couleur = '#4CAF50';
            } else if (score >= 60) {
                description = 'Bon investissement';
                couleur = '#FF9800';
            } else if (score >= 40) {
                description = 'Investissement moyen';
                couleur = '#FF5722';
            } else {
                description = 'Investissement risqu√©';
                couleur = '#F44336';
            }
            
            document.getElementById('scoreDescription').textContent = description;
            document.getElementById('scoreCircle').style.background = `conic-gradient(from 0deg, ${couleur} 0deg, ${couleur} ${score * 3.6}deg, rgba(255,255,255,0.2) ${score * 3.6}deg, rgba(255,255,255,0.2) 360deg)`;
        }

        function genererRecommandations(rentabiliteBrute, rentabiliteNette, cashFlow, prix, loyer) {
            const recommendations = [];
            
            if (rentabiliteBrute >= 6) {
                recommendations.push({
                    icon: '‚úÖ',
                    title: 'Rentabilit√© excellente',
                    text: 'Votre rentabilit√© brute d√©passe 6%, c\'est un excellent investissement.'
                });
            } else if (rentabiliteBrute < 4) {
                recommendations.push({
                    icon: '‚ö†Ô∏è',
                    title: 'Rentabilit√© faible',
                    text: 'N√©gociez le prix d\'achat ou augmentez le loyer pour am√©liorer la rentabilit√©.'
                });
            }
            
            if (cashFlow < 0) {
                recommendations.push({
                    icon: 'üî¥',
                    title: 'Cash-flow n√©gatif',
                    text: 'Vous devrez compl√©ter chaque mois. R√©duisez les charges ou augmentez les revenus.'
                });
            } else if (cashFlow > 200) {
                recommendations.push({
                    icon: 'üí∞',
                    title: 'Excellent cash-flow',
                    text: 'Votre investissement g√©n√®re un cash-flow positif important.'
                });
            }
            
            if ((loyer * 12) > (prix * 0.08)) {
                recommendations.push({
                    icon: 'üéØ',
                    title: 'Ratio loyer/prix optimal',
                    text: 'Le rapport loyer/prix est tr√®s favorable √† l\'investissement.'
                });
            }
            
            recommendations.push({
                icon: 'üí°',
                title: 'Conseil g√©n√©ral',
                text: 'V√©rifiez l\'√©tat du bien et pr√©voyez une provision pour travaux futurs.'
            });
            
            // Affichage des recommandations
            const container = document.getElementById('recommendationsList');
            container.innerHTML = recommendations.map(rec => 
                `<div class="recommendation-item">
                    <strong>${rec.icon} ${rec.title}</strong><br>
                    ${rec.text}
                </div>`
            ).join('');
        }

        function chargerDonneesVille() {
            const ville = document.getElementById('ville').value;
            const marketData = document.getElementById('marketData');
            
            if (ville && donneesMarche[ville]) {
                const data = donneesMarche[ville];
                
                document.getElementById('prixM2').textContent = data.prixM2.toLocaleString() + '‚Ç¨';
                document.getElementById('loyerM2').textContent = data.loyerM2 + '‚Ç¨';
                document.getElementById('rentabiliteVille').textContent = data.rentabilite + '%';
                document.getElementById('tendanceMarche').textContent = data.tendance;
                
                marketData.style.display = 'grid';
                
                // Suggestion automatique bas√©e sur les donn√©es de march√©
                const surface = parseFloat(document.getElementById('surface').value) || 65;
                const prixSuggere = data.prixM2 * surface;
                const loyerSuggere = Math.round(data.loyerM2 * surface);
                
                if (confirm(`Voulez-vous utiliser les donn√©es de march√© de ${ville.charAt(0).toUpperCase() + ville.slice(1)} ?\n\nPrix sugg√©r√©: ${prixSuggere.toLocaleString()}‚Ç¨\nLoyer sugg√©r√©: ${loyerSuggere}‚Ç¨`)) {
                    document.getElementById('prix').value = prixSuggere;
                    document.getElementById('loyerMensuel').value = loyerSuggere;
                    calculer();
                }
            } else {
                marketData.style.display = 'none';
            }
            
            calculer();
        }

        // Gestion du th√®me
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            appliquerTheme(currentTheme);
            localStorage.setItem('theme', currentTheme);
        }

        function appliquerTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            const themeText = document.getElementById('themeText');
            const themeIcon = document.querySelector('.theme-toggle i');
            
            if (theme === 'dark') {
                themeText.textContent = 'Mode clair';
                themeIcon.className = 'fas fa-sun';
            } else {
                themeText.textContent = 'Mode sombre';
                themeIcon.className = 'fas fa-moon';
            }
        }

        // Sauvegarde automatique
        function calculerEtSauver() {
            calculer();
            sauvegarderAutomatique();
        }

        function sauvegarderAutomatique() {
            const formData = {
                ville: document.getElementById('ville').value,
                prix: document.getElementById('prix').value,
                surface: document.getElementById('surface').value,
                fraisNotaire: document.getElementById('fraisNotaire').value,
                travaux: document.getElementById('travaux').value,
                apport: document.getElementById('apport').value,
                tauxCredit: document.getElementById('tauxCredit').value,
                dureeCredit: document.getElementById('dureeCredit').value,
                assuranceCredit: document.getElementById('assuranceCredit').value,
                loyerMensuel: document.getElementById('loyerMensuel').value,
                chargesRecuperables: document.getElementById('chargesRecuperables').value,
                chargesCopro: document.getElementById('chargesCopro').value,
                taxeFonciere: document.getElementById('taxeFonciere').value,
                assurancePno: document.getElementById('assurancePno').value,
                gestionLocative: document.getElementById('gestionLocative').value
            };
            
            localStorage.setItem('simulateurData', JSON.stringify(formData));
            afficherIndicateurSauvegarde();
        }

        function afficherIndicateurSauvegarde() {
            const indicator = document.getElementById('saveIndicator');
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }

        function chargerDonneesSauvegardees() {
            const savedData = localStorage.getItem('simulateurData');
            if (savedData) {
                const data = JSON.parse(savedData);
                Object.keys(data).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        element.value = data[key];
                    }
                });
                
                // Charger les donn√©es de march√© si une ville est s√©lectionn√©e
                if (data.ville) {
                    chargerDonneesVille();
                }
            }
        }

        function sauvegarderDonnees() {
            sauvegarderAutomatique();
            alert('üíæ Donn√©es sauvegard√©es avec succ√®s !');
        }

        // Export PDF
        function exporterPDF() {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();
            
            // Configuration
            pdf.setFont("helvetica");
            
            // Titre
            pdf.setFontSize(20);
            pdf.text('üìä RAPPORT D\'INVESTISSEMENT IMMOBILIER', 20, 30);
            
            // Date
            pdf.setFontSize(10);
            pdf.text('G√©n√©r√© le : ' + new Date().toLocaleDateString('fr-FR'), 150, 30);
            
            // Ligne de s√©paration
            pdf.line(20, 35, 190, 35);
            
            let yPosition = 50;
            
            // Section Localisation
            const ville = document.getElementById('ville').value;
            if (ville) {
                pdf.setFontSize(14);
                pdf.text('üèôÔ∏è LOCALISATION', 20, yPosition);
                yPosition += 10;
                pdf.setFontSize(10);
                pdf.text(`Ville: ${ville.charAt(0).toUpperCase() + ville.slice(1)}`, 25, yPosition);
                yPosition += 15;
            }
            
            // Section Investissement
            pdf.setFontSize(14);
            pdf.text('üí∞ D√âTAILS DE L\'INVESTISSEMENT', 20, yPosition);
            yPosition += 10;
            pdf.setFontSize(10);
            
            const details = [
                `Prix d'achat: ${parseFloat(document.getElementById('prix').value).toLocaleString()} ‚Ç¨`,
                `Surface: ${document.getElementById('surface').value} m¬≤`,
                `Apport personnel: ${parseFloat(document.getElementById('apport').value).toLocaleString()} ‚Ç¨`,
                `Loyer mensuel: ${parseFloat(document.getElementById('loyerMensuel').value).toLocaleString()} ‚Ç¨`
            ];
            
            details.forEach(detail => {
                pdf.text(detail, 25, yPosition);
                yPosition += 7;
            });
            
            yPosition += 10;
            
            // Section R√©sultats
            pdf.setFontSize(14);
            pdf.text('üìä R√âSULTATS FINANCIERS', 20, yPosition);
            yPosition += 10;
            pdf.setFontSize(10);
            
            const resultats = [
                `Rentabilit√© brute: ${document.getElementById('rentabiliteBrute').textContent}`,
                `Rentabilit√© nette: ${document.getElementById('rentabiliteNette').textContent}`,
                `Cash-flow mensuel: ${document.getElementById('cashFlowMensuel').textContent}`,
                `Rentabilit√© sur apport: ${document.getElementById('rentabiliteApport').textContent}`,
                `Score IA: ${document.getElementById('scoreValue').textContent}/100`
            ];
            
            resultats.forEach(resultat => {
                pdf.text(resultat, 25, yPosition);
                yPosition += 7;
            });
            
            // Footer
            pdf.setFontSize(8);
            pdf.text('Simulateur Immobilier Pro - Rapport g√©n√©r√© automatiquement', 20, 280);
            pdf.text('Les r√©sultats sont indicatifs et ne constituent pas un conseil en investissement.', 20, 285);
            
            // T√©l√©chargement
            pdf.save(`rapport-investissement-${new Date().toISOString().split('T')[0]}.pdf`);
        }

        // Export Excel
        function exporterExcel() {
            const donnees = [
                ['RAPPORT D\'INVESTISSEMENT IMMOBILIER'],
                [''],
                ['Date', new Date().toLocaleDateString('fr-FR')],
                [''],
                ['PARAM√àTRES'],
                ['Ville', document.getElementById('ville').value || 'Non sp√©cifi√©e'],
                ['Prix d\'achat', parseFloat(document.getElementById('prix').value)],
                ['Surface (m¬≤)', document.getElementById('surface').value],
                ['Apport personnel', parseFloat(document.getElementById('apport').value)],
                ['Loyer mensuel', parseFloat(document.getElementById('loyerMensuel').value)],
                [''],
                ['R√âSULTATS'],
                ['Rentabilit√© brute', document.getElementById('rentabiliteBrute').textContent],
                ['Rentabilit√© nette', document.getElementById('rentabiliteNette').textContent],
                ['Cash-flow mensuel', document.getElementById('cashFlowMensuel').textContent],
                ['Rentabilit√© sur apport', document.getElementById('rentabiliteApport').textContent],
                ['Score IA', document.getElementById('scoreValue').textContent + '/100']
            ];
            
            const ws = XLSX.utils.aoa_to_sheet(donnees);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Rapport");
            
            XLSX.writeFile(wb, `rapport-investissement-${new Date().toISOString().split('T')[0]}.xlsx`);
        }
    </script>
</body>
</html>
