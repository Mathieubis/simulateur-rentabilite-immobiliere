# simulateur-rentabilite-immobiliere
Description: Simulateur de rentabilit√© pour investissement immobilier
<!DOCTYPE html>
<html lang="fr" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulateur Immobilier Pro</title>
    
    <!-- CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/all.min.css">
    
    <style>
        :root[data-theme="light"] {
            --bg-primary: #f0f2f5;
            --bg-secondary: #ffffff;
            --text-primary: #333333;
            --text-secondary: #666666;
            --card-bg: #ffffff;
            --border-color: #e1e5e9;
            --shadow: 0 8px 25px rgba(0,0,0,0.1);
            --accent: #2196F3;
            --success: #4CAF50;
            --warning: #FF9800;
            --danger: #F44336;
        }

        :root[data-theme="dark"] {
            --bg-primary: #121212;
            --bg-secondary: #1e1e1e;
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --card-bg: #2d2d2d;
            --border-color: #404040;
            --shadow: 0 8px 25px rgba(0,0,0,0.3);
            --accent: #64B5F6;
            --success: #81C784;
            --warning: #FFB74D;
            --danger: #E57373;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            transition: all 0.3s ease;
            background-image: 
                linear-gradient(135deg, #667eea 0%, #764ba2 100%),
                linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 70%);
            background-attachment: fixed;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .header h1 {
            color: var(--accent);
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background: var(--warning);
        }

        .btn-success {
            background: var(--success);
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .card h2 {
            color: var(--accent);
            margin-bottom: 25px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-primary);
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .result-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .result-card:hover {
            transform: translateY(-5px);
        }

        .result-label {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .result-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .positive {
            color: var(--success);
        }

        .negative {
            color: var(--danger);
        }

        .neutral {
            color: var(--warning);
        }

        .score-section {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            margin-bottom: 30px;
            text-align: center;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: conic-gradient(from 0deg, var(--success) 0deg, var(--success) var(--score-angle, 0deg), rgba(255,255,255,0.2) var(--score-angle, 0deg));
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px auto;
            position: relative;
        }

        .score-inner {
            width: 120px;
            height: 120px;
            background: var(--card-bg);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .score-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .score-text {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .recommendations {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            margin-bottom: 30px;
        }

        .recommendations h3 {
            color: var(--accent);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .recommendation-item {
            background: var(--bg-primary);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid var(--accent);
        }

        .footer {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            margin-top: 50px;
        }

        .save-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            transform: translateX(300px);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .save-indicator.show {
            transform: translateX(0);
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
        }

        /* Animation d'entr√©e */
        .card {
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-calculator"></i> Simulateur Immobilier Pro</h1>
            <p>Analysez la rentabilit√© de votre investissement immobilier en quelques clics</p>
        </div>

        <!-- Contr√¥les -->
        <div class="controls">
            <button class="btn" onclick="toggleTheme()">
                <i class="fas fa-moon"></i>
                <span id="themeText">Mode sombre</span>
            </button>
            <button class="btn btn-secondary" onclick="sauvegarderDonnees()">
                <i class="fas fa-save"></i>
                Sauvegarder
            </button>
            <button class="btn btn-success" onclick="exporterPDF()">
                <i class="fas fa-file-pdf"></i>
                Export PDF
            </button>
            <button class="btn" onclick="exporterExcel()">
                <i class="fas fa-file-excel"></i>
                Export Excel
            </button>
        </div>

        <!-- Grid principal -->
        <div class="main-grid">
            <!-- Param√®tres d'achat -->
            <div class="card">
                <h2><i class="fas fa-home"></i> Param√®tres d'achat</h2>
                
                <div class="form-group">
                    <label>Prix d'achat (‚Ç¨)</label>
                    <input type="number" id="prix" value="250000" oninput="calculerEtSauver()" placeholder="250000">
                </div>
                
                <div class="form-group">
                    <label>Surface (m¬≤)</label>
                    <input type="number" id="surface" value="65" oninput="calculerEtSauver()" placeholder="65">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Frais de notaire (%)</label>
                        <input type="number" id="fraisNotaire" value="7.5" step="0.1" oninput="calculerEtSauver()" placeholder="7.5">
                    </div>
                    <div class="form-group">
                        <label>Travaux (‚Ç¨)</label>
                        <input type="number" id="travaux" value="15000" oninput="calculerEtSauver()" placeholder="15000">
                    </div>
                </div>
            </div>

            <!-- Financement -->
            <div class="card">
                <h2><i class="fas fa-university"></i> Financement</h2>
                
                <div class="form-group">
                    <label>Apport personnel (‚Ç¨)</label>
                    <input type="number" id="apport" value="50000" oninput="calculerEtSauver()" placeholder="50000">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Taux cr√©dit (%)</label>
                        <input type="number" id="tauxCredit" value="3.5" step="0.01" oninput="calculerEtSauver()" placeholder="3.5">
                    </div>
                    <div class="form-group">
                        <label>Dur√©e (ann√©es)</label>
                        <input type="number" id="dureeCredit" value="20" oninput="calculerEtSauver()" placeholder="20">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Assurance emprunteur (% du capital)</label>
                    <input type="number" id="assuranceCredit" value="0.36" step="0.01" oninput="calculerEtSauver()" placeholder="0.36">
                </div>
            </div>
        </div>

        <!-- Revenus et charges -->
        <div class="main-grid">
            <div class="card">
                <h2><i class="fas fa-euro-sign"></i> Revenus locatifs</h2>
                
                <div class="form-group">
                    <label>Loyer mensuel (‚Ç¨)</label>
                    <input type="number" id="loyerMensuel" value="1200" oninput="calculerEtSauver()" placeholder="1200">
                </div>
                
                <div class="form-group">
                    <label>Charges r√©cup√©rables (‚Ç¨/mois)</label>
                    <input type="number" id="chargesRecuperables" value="0" oninput="calculerEtSauver()" placeholder="0">
                </div>
            </div>

            <div class="card">
                <h2><i class="fas fa-receipt"></i> Charges</h2>
                
                <div class="form-group">
                    <label>Charges copropri√©t√© (‚Ç¨/mois)</label>
                    <input type="number" id="chargesCopro" value="80" oninput="calculerEtSauver()" placeholder="80">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Taxe fonci√®re (‚Ç¨/an)</label>
                        <input type="number" id="taxeFonciere" value="1200" oninput="calculerEtSauver()" placeholder="1200">
                    </div>
                    <div class="form-group">
                        <label>Assurance PNO (‚Ç¨/an)</label>
                        <input type="number" id="assurancePno" value="300" oninput="calculerEtSauver()" placeholder="300">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Gestion locative (% du loyer)</label>
                    <input type="number" id="gestionLocative" value="0" step="0.1" oninput="calculerEtSauver()" placeholder="0">
                </div>
            </div>
        </div>

        <!-- R√©sultats -->
        <div class="results-grid">
            <div class="result-card">
                <div class="result-label">Rentabilit√© brute</div>
                <div class="result-value positive" id="rentabiliteBrute">5.76%</div>
            </div>
            
            <div class="result-card">
                <div class="result-label">Rentabilit√© nette</div>
                <div class="result-value neutral" id="rentabiliteNette">4.12%</div>
            </div>
            
            <div class="result-card">
                <div class="result-label">Cash-flow mensuel</div>
                <div class="result-value negative" id="cashFlowMensuel">-150‚Ç¨</div>
            </div>
            
            <div class="result-card">
                <div class="result-label">Rentabilit√© sur apport</div>
                <div class="result-value neutral" id="rentabiliteApport">8.5%</div>
            </div>
            
            <div class="result-card">
                <div class="result-label">Mensualit√© cr√©dit</div>
                <div class="result-value" id="mensualiteCredit">1,150‚Ç¨</div>
            </div>
            
            <div class="result-card">
                <div class="result-label">Temps de retour</div>
                <div class="result-value neutral" id="tempsRetour">12.5 ans</div>
            </div>
        </div>

        <!-- Score IA -->
        <div class="score-section">
            <h2><i class="fas fa-robot"></i> Score IA de l'investissement</h2>
            <div class="score-circle" id="scoreCircle" style="--score-angle: 216deg;">
                <div class="score-inner">
                    <div class="score-value" id="scoreValue">60</div>
                    <div class="score-text">/ 100</div>
                </div>
            </div>
            <p id="scoreDescription" style="font-size: 1.2rem; color: var(--accent); font-weight: 600;">Investissement moyen</p>
        </div>

        <!-- Recommandations -->
        <div class="recommendations">
            <h3><i class="fas fa-lightbulb"></i> Recommandations personnalis√©es</h3>
            <div id="recommendationsList">
                <div class="recommendation-item">
                    <strong>üí° Analyse en cours...</strong><br>
                    Modifiez les param√®tres pour obtenir des recommandations personnalis√©es.
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <h3><i class="fas fa-info-circle"></i> √Ä propos</h3>
            <p>Ce simulateur vous aide √† √©valuer la rentabilit√© de vos investissements immobiliers. Les r√©sultats sont indicatifs et ne constituent pas un conseil en investissement.</p>
            <br>
            <p style="color: var(--text-secondary);">¬© 2024 Simulateur Immobilier Pro - Tous droits r√©serv√©s</p>
        </div>
    </div>

    <!-- Indicateur de sauvegarde -->
    <div class="save-indicator" id="saveIndicator">
        <i class="fas fa-check"></i> Sauvegard√© automatiquement
    </div>

    <script>
        // Variables globales
        let currentTheme = localStorage.getItem('theme') || 'light';

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            appliquerTheme(currentTheme);
            chargerDonneesSauvegardees();
            calculer();
        });

        // Fonction de calcul principale
        function calculer() {
            // R√©cup√©ration des valeurs
            const prix = parseFloat(document.getElementById('prix').value) || 0;
            const surface = parseFloat(document.getElementById('surface').value) || 0;
            const fraisNotaire = parseFloat(document.getElementById('fraisNotaire').value) || 0;
            const travaux = parseFloat(document.getElementById('travaux').value) || 0;
            const apport = parseFloat(document.getElementById('apport').value) || 0;
            const tauxCredit = parseFloat(document.getElementById('tauxCredit').value) || 0;
            const dureeCredit = parseFloat(document.getElementById('dureeCredit').value) || 0;
            const assuranceCredit = parseFloat(document.getElementById('assuranceCredit').value) || 0;
            const loyerMensuel = parseFloat(document.getElementById('loyerMensuel').value) || 0;
            const chargesRecuperables = parseFloat(document.getElementById('chargesRecuperables').value) || 0;
            const chargesCopro = parseFloat(document.getElementById('chargesCopro').value) || 0;
            const taxeFonciere = parseFloat(document.getElementById('taxeFonciere').value) || 0;
            const assurancePno = parseFloat(document.getElementById('assurancePno').value) || 0;
            const gestionLocative = parseFloat(document.getElementById('gestionLocative').value) || 0;

            // Calculs
            const fraisNotaireEuros = prix * (fraisNotaire / 100);
            const investissementTotal = prix + fraisNotaireEuros + travaux;
            const montantEmprunte = investissementTotal - apport;
            
            const tauxMensuel = tauxCredit / 100 / 12;
            const nbMensualites = dureeCredit * 12;
            let mensualiteCredit = 0;
            if (tauxMensuel > 0) {
                mensualiteCredit = montantEmprunte * (tauxMensuel * Math.pow(1 + tauxMensuel, nbMensualites)) / (Math.pow(1 + tauxMensuel, nbMensualites) - 1);
            } else if (montantEmprunte > 0) {
                mensualiteCredit = montantEmprunte / nbMensualites;
            }
            
            const assuranceMensuelle = montantEmprunte * (assuranceCredit / 100) / 12;
            
            const revenus = loyerMensuel + chargesRecuperables;
            const chargesMensuelles = chargesCopro + (taxeFonciere / 12) + (assurancePno / 12) + (revenus * gestionLocative / 100);
            
            const cashFlowMensuel = revenus - mensualiteCredit - assuranceMensuelle - chargesMensuelles;
            const revenuAnnuelNet = (revenus - chargesMensuelles) * 12;
            
            const rentabiliteBrute = prix > 0 ? ((loyerMensuel * 12) / prix) * 100 : 0;
            const rentabiliteNette = investissementTotal > 0 ? (revenuAnnuelNet / investissementTotal) * 100 : 0;
            const rentabiliteApport = apport > 0 ? ((cashFlowMensuel * 12) / apport) * 100 : 0;
            const tempsRetour = cashFlowMensuel > 0 ? apport / (cashFlowMensuel * 12) : 0;

            // Mise √† jour de l'affichage
            document.getElementById('rentabiliteBrute').textContent = rentabiliteBrute.toFixed(2) + '%';
            document.getElementById('rentabiliteNette').textContent = rentabiliteNette.toFixed(2) + '%';
            document.getElementById('cashFlowMensuel').textContent = (cashFlowMensuel >= 0 ? '+' : '') + Math.round(cashFlowMensuel).toLocaleString() + '‚Ç¨';
            document.getElementById('rentabiliteApport').textContent = rentabiliteApport.toFixed(2) + '%';
            document.getElementById('tempsRetour').textContent = tempsRetour > 0 ? tempsRetour.toFixed(1) + ' ans' : 'N/A';
            document.getElementById('mensualiteCredit').textContent = Math.round(mensualiteCredit + assuranceMensuelle).toLocaleString() + '‚Ç¨';

            // Mise √† jour des couleurs
            mettreAJourCouleurs('rentabiliteBrute', rentabiliteBrute, 4, 6);
            mettreAJourCouleurs('rentabiliteNette', rentabiliteNette, 3, 5);
            mettreAJourCouleurs('cashFlowMensuel', cashFlowMensuel, 0, 200);
            mettreAJourCouleurs('rentabiliteApport', rentabiliteApport, 8, 15);

            // Calcul du score IA
            calculerScoreIA(rentabiliteBrute, rentabiliteNette, cashFlowMensuel, rentabiliteApport);
            
            // G√©n√©rer recommandations
            genererRecommandations(rentabiliteBrute, rentabiliteNette, cashFlowMensuel, prix, loyerMensuel);
        }

        function mettreAJourCouleurs(elementId, valeur, seuilNegatif, seuilPositif) {
            const element = document.getElementById(elementId);
            element.classList.remove('positive', 'negative', 'neutral');
            
            if (valeur >= seuilPositif) {
                element.classList.add('positive');
            } else if (valeur <= seuilNegatif) {
                element.classList.add('negative');
            } else {
                element.classList.add('neutral');
            }
        }

        function calculerScoreIA(rentabiliteBrute, rentabiliteNette, cashFlow, rentabiliteApport) {
            let score = 0;
            
            // Crit√®res de notation
            if (rentabiliteBrute >= 7) score += 25;
            else if (rentabiliteBrute >= 5) score += 20;
            else if (rentabiliteBrute >= 4) score += 15;
            else if (rentabiliteBrute >= 3) score += 10;
            
            if (rentabiliteNette >= 5) score += 20;
            else if (rentabiliteNette >= 4) score += 15;
            else if (rentabiliteNette >= 3) score += 10;
            else if (rentabiliteNette >= 2) score += 5;
            
            if (cashFlow >= 300) score += 20;
            else if (cashFlow >= 100) score += 15;
            else if (cashFlow >= 0) score += 10;
            else if (cashFlow >= -100) score += 5;
            
            if (rentabiliteApport >= 15) score += 20;
            else if (rentabiliteApport >= 12) score += 15;
            else if (rentabiliteApport >= 10) score += 10;
            else if (rentabiliteApport >= 8) score += 5;
            
            // Bonus divers
            score += 15; // Bonus de base
            
            score = Math.min(100, Math.max(0, score));
            
            // Mise √† jour de l'affichage
            document.getElementById('scoreValue').textContent = score;
            document.getElementById('scoreCircle').style.setProperty('--score-angle', (score * 3.6) + 'deg');
            
            let description, couleur;
            if (score >= 80) {
                description = 'Excellent investissement';
                couleur = '#4CAF50';
            } else if (score >= 60) {
                description = 'Bon investissement';
                couleur = '#FF9800';
            } else if (score >= 40) {
                description = 'Investissement moyen';
                couleur = '#FF5722';
            } else {
                description = 'Investissement risqu√©';
                couleur = '#F44336';
            }
            
            document.getElementById('scoreDescription').textContent = description;
            document.getElementById('scoreCircle').style.background = `conic-gradient(from 0deg, ${couleur} 0deg, ${couleur} ${score * 3.6}deg, rgba(255,255,255,0.2) ${score * 3.6}deg)`;
        }

        function genererRecommandations(rentabiliteBrute, rentabiliteNette, cashFlow, prix, loyer) {
            const recommendations = [];
            
            if (rentabiliteBrute >= 6) {
                recommendations.push({
                    icon: '‚úÖ',
                    title: 'Rentabilit√© excellente',
                    text: 'Votre rentabilit√© brute d√©passe 6%, c\'est un excellent investissement.'
                });
            } else if (rentabiliteBrute < 4) {
                recommendations.push({
                    icon: '‚ö†Ô∏è',
                    title: 'Rentabilit√© faible',
                    text: 'N√©gociez le prix d\'achat ou augmentez le loyer pour am√©liorer la rentabilit√©.'
                });
            }
            
            if (cashFlow < 0) {
                recommendations.push({
                    icon: 'üî¥',
                    title: 'Cash-flow n√©gatif',
                    text: 'Vous devrez compl√©ter chaque mois. R√©duisez les charges ou augmentez les revenus.'
                });
            } else if (cashFlow > 200) {
                recommendations.push({
                    icon: 'üí∞',
                    title: 'Excellent cash-flow',
                    text: 'Votre investissement g√©n√®re un cash-flow positif important.'
                });
            }
            
            if ((loyer * 12) > (prix * 0.08)) {
                recommendations.push({
                    icon: 'üéØ',
                    title: 'Ratio loyer/prix optimal',
                    text: 'Le rapport loyer/prix est tr√®s favorable √† l\'investissement.'
                });
            }
            
            recommendations.push({
                icon: 'üí°',
                title: 'Conseil g√©n√©ral',
                text: 'Diversifiez vos investissements et constituez une r√©serve pour les travaux et vacances locatives.'
            });
            
            // Affichage des recommandations
            const container = document.getElementById('recommendationsList');
            container.innerHTML = '';
            
            recommendations.forEach(rec => {
                const div = document.createElement('div');
                div.className = 'recommendation-item';
                div.innerHTML = `
                    <strong>${rec.icon} ${rec.title}</strong><br>
                    ${rec.text}
                `;
                container.appendChild(div);
            });
        }

        // Fonction de calcul avec sauvegarde
        function calculerEtSauver() {
            calculer();
            sauvegarderAutomatique();
        }

        // Gestion des th√®mes
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            appliquerTheme(currentTheme);
            localStorage.setItem('theme', currentTheme);
        }

        function appliquerTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            const themeText = document.getElementById('themeText');
            if (theme === 'dark') {
                themeText.textContent = 'Mode clair';
                themeText.previousElementSibling.className = 'fas fa-sun';
            } else {
                themeText.textContent = 'Mode sombre';
                themeText.previousElementSibling.className = 'fas fa-moon';
            }
        }

        // Sauvegarde automatique
        function sauvegarderAutomatique() {
            const donnees = {
                prix: document.getElementById('prix').value,
                surface: document.getElementById('surface').value,
                fraisNotaire: document.getElementById('fraisNotaire').value,
                travaux: document.getElementById('travaux').value,
                apport: document.getElementById('apport').value,
                tauxCredit: document.getElementById('tauxCredit').value,
                dureeCredit: document.getElementById('dureeCredit').value,
                assuranceCredit: document.getElementById('assuranceCredit').value,
                loyerMensuel: document.getElementById('loyerMensuel').value,
                chargesRecuperables: document.getElementById('chargesRecuperables').value,
                chargesCopro: document.getElementById('chargesCopro').value,
                taxeFonciere: document.getElementById('taxeFonciere').value,
                assurancePno: document.getElementById('assurancePno').value,
                gestionLocative: document.getElementById('gestionLocative').value
            };
            
            localStorage.setItem('simulateurDonnees', JSON.stringify(donnees));
            
            // Afficher l'indicateur de sauvegarde
            const indicator = document.getElementById('saveIndicator');
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }

        // Sauvegarde manuelle
        function sauvegarderDonnees() {
            sauvegarderAutomatique();
            alert('Donn√©es sauvegard√©es avec succ√®s !');
        }

        // Charger les donn√©es sauvegard√©es
        function chargerDonneesSauvegardees() {
            const donneesString = localStorage.getItem('simulateurDonnees');
            if (donneesString) {
                try {
                    const donnees = JSON.parse(donneesString);
                    Object.keys(donnees).forEach(key => {
                        const element = document.getElementById(key);
                        if (element) {
                            element.value = donnees[key];
                        }
                    });
                } catch (e) {
                    console.log('Erreur lors du chargement des donn√©es:', e);
                }
            }
        }

        // Export PDF
        function exporterPDF() {
            if (typeof window.jsPDF === 'undefined') {
                alert('Erreur: jsPDF non disponible');
                return;
            }

            const { jsPDF } = window.jsPDF;
            const pdf = new jsPDF();
            
            // En-t√™te
            pdf.setFontSize(20);
            pdf.text('RAPPORT D\'INVESTISSEMENT IMMOBILIER', 20, 30);
            
            pdf.setFontSize(12);
            pdf.text(`G√©n√©r√© le: ${new Date().toLocaleDateString('fr-FR')}`, 20, 45);
            
            // Param√®tres
            pdf.setFontSize(16);
            pdf.text('PARAM√àTRES D\'INVESTISSEMENT', 20, 65);
            
            pdf.setFontSize(12);
            let y = 80;
            
            const parametres = [
                ['Prix d\'achat:', document.getElementById('prix').value + ' ‚Ç¨'],
                ['Surface:', document.getElementById('surface').value + ' m¬≤'],
                ['Apport personnel:', document.getElementById('apport').value + ' ‚Ç¨'],
                ['Loyer mensuel:', document.getElementById('loyerMensuel').value + ' ‚Ç¨'],
                ['Taux cr√©dit:', document.getElementById('tauxCredit').value + ' %'],
                ['Dur√©e cr√©dit:', document.getElementById('dureeCredit').value + ' ans']
            ];
            
            parametres.forEach(param => {
                pdf.text(param[0], 20, y);
                pdf.text(param[1], 120, y);
                y += 8;
            });
            
            // R√©sultats
            y += 15;
            pdf.setFontSize(16);
            pdf.text('R√âSULTATS', 20, y);
            
            y += 15;
            pdf.setFontSize(12);
            
            const resultats = [
                ['Rentabilit√© brute:', document.getElementById('rentabiliteBrute').textContent],
                ['Rentabilit√© nette:', document.getElementById('rentabiliteNette').textContent],
                ['Cash-flow mensuel:', document.getElementById('cashFlowMensuel').textContent],
                ['Rentabilit√© sur apport:', document.getElementById('rentabiliteApport').textContent],
                ['Mensualit√© cr√©dit:', document.getElementById('mensualiteCredit').textContent],
                ['Temps de retour:', document.getElementById('tempsRetour').textContent]
            ];
            
            resultats.forEach(resultat => {
                pdf.text(resultat[0], 20, y);
                pdf.text(resultat[1], 120, y);
                y += 8;
            });
            
            // Score IA
            y += 15;
            pdf.setFontSize(16);
            pdf.text('SCORE IA', 20, y);
            
            y += 15;
            pdf.setFontSize(12);
            pdf.text('Score:', 20, y);
            pdf.text(document.getElementById('scoreValue').textContent + '/100', 120, y);
            y += 8;
            pdf.text('√âvaluation:', 20, y);
            pdf.text(document.getElementById('scoreDescription').textContent, 120, y);
            
            // Disclaimer
            y += 30;
            pdf.setFontSize(10);
            pdf.text('Ce rapport est g√©n√©r√© automatiquement par le Simulateur Immobilier Pro.', 20, y);
            y += 5;
            pdf.text('Les r√©sultats sont indicatifs et ne constituent pas un conseil en investissement.', 20, y);
            
            // T√©l√©chargement
            pdf.save(`rapport-investissement-${new Date().toISOString().split('T')[0]}.pdf`);
        }

        // Export Excel
        function exporterExcel() {
            if (typeof XLSX === 'undefined') {
                alert('Erreur: XLSX non disponible');
                return;
            }

            const donnees = [
                ['RAPPORT D\'INVESTISSEMENT IMMOBILIER'],
                [''],
                ['Date:', new Date().toLocaleDateString('fr-FR')],
                [''],
                ['PARAM√àTRES'],
                ['Prix d\'achat:', parseFloat(document.getElementById('prix').value) || 0],
                ['Surface (m¬≤):', document.getElementById('surface').value || ''],
                ['Apport personnel:', parseFloat(document.getElementById('apport').value) || 0],
                ['Loyer mensuel:', parseFloat(document.getElementById('loyerMensuel').value) || 0],
                ['Taux cr√©dit:', parseFloat(document.getElementById('tauxCredit').value) || 0],
                ['Dur√©e cr√©dit:', parseFloat(document.getElementById('dureeCredit').value) || 0],
                [''],
                ['R√âSULTATS'],
                ['Rentabilit√© brute:', document.getElementById('rentabiliteBrute').textContent],
                ['Rentabilit√© nette:', document.getElementById('rentabiliteNette').textContent],
                ['Cash-flow mensuel:', document.getElementById('cashFlowMensuel').textContent],
                ['Rentabilit√© sur apport:', document.getElementById('rentabiliteApport').textContent],
                ['Temps de retour:', document.getElementById('tempsRetour').textContent],
                [''],
                ['SCORE IA'],
                ['Score:', document.getElementById('scoreValue').textContent + '/100'],
                ['√âvaluation:', document.getElementById('scoreDescription').textContent]
            ];
            
            const ws = XLSX.utils.aoa_to_sheet(donnees);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Rapport");
            
            XLSX.writeFile(wb, `rapport-investissement-${new Date().toISOString().split('T')[0]}.xlsx`);
        }
    </script>
</body>
</html>
